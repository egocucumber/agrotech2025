# РУКОВОДСТВО ПРОГРАММИСТА

## 1. НАЗНАЧЕНИЕ И УСЛОВИЯ ПРИМЕНЕНИЯ ПРОГРАММ

### 1.1. Назначение и функции программы

Программа AgroVzor предназначена для автоматизации и мониторинга процесса трехзвенной уборки урожая зерновых культур. Система обеспечивает автоматизированное взаимодействие между комбайном, бункером-перегрузчиком и зерновозом, осуществляет учет и контроль перемещения зерна, анализирует потери урожая, мониторит состояние техники и эффективность работы механизаторов.

**Основные функции:**
- Управление организационной структурой
- Планирование и учет полевых работ
- Сбор и обработка телеметрических данных
- Аналитика и мониторинг
- Визуализация данных и формирование отчетов

### 1.2. Условия, необходимые для выполнения программы

**Объем оперативной памяти:**
- Серверная часть: минимум 2 GB, рекомендуется 4-8 GB
- Клиентская часть: минимум 512 MB в браузере

**Требования к составу и параметрам периферийных устройств:**
- Сетевая карта: 100 Мбит/с (минимально), 1 Гбит/с (рекомендуется)
- Дисковое пространство: 10 GB (минимально), 50 GB (рекомендуется, SSD)

**Требования к программному обеспечению:**

**Серверная часть:**
- Java Runtime Environment версии 17 или выше
- Spring Boot Framework версии 4.0.0
- PostgreSQL версии 16 или выше
- Docker и Docker Compose (для контейнеризации)

**Клиентская часть:**
- Node.js версии 20 или выше
- Next.js Framework версии 16.0.3
- React версии 19.2.0
- TypeScript версии 5 или выше
- Современный веб-браузер с поддержкой ES6+

## 2. ХАРАКТЕРИСТИКА ПРОГРАММЫ

### 2.1. Временные характеристики

- Время отклика API: не более 500 мс для стандартных запросов
- Время обработки телеметрических пакетов: не более 100 мс
- Время расчета аналитических показателей: не более 2 секунд
- Обновление данных в веб-интерфейсе: в реальном времени или с задержкой не более 5 секунд

### 2.2. Режим работы

- Непрерывная работа 24/7
- Обработка запросов в реальном времени
- Асинхронная обработка телеметрических данных
- Периодическая синхронизация данных при восстановлении связи

### 2.3. Средства контроля правильности выполнения

- Валидация всех входных данных
- Проверка типов данных и диапазонов значений
- Контроль целостности данных при передаче
- Логирование всех операций для аудита
- Обработка ошибок с возвратом понятных сообщений

### 2.4. Самовосстанавливаемость программы

- Автоматическое восстановление после программных сбоев
- Автоматическая синхронизация данных при восстановлении связи
- Транзакционная обработка для защиты от потери данных
- Резервное копирование данных
- Мониторинг работоспособности с автоматическим оповещением

## 3. ОБРАЩЕНИЕ К ПРОГРАММЕ

### 3.1. Способы передачи управления

**Серверная часть:**

Программа запускается как Spring Boot приложение:

```bash
./gradlew bootRun
```

или

```bash
java -jar agrovzor-back-0.0.1-SNAPSHOT.jar
```

**Клиентская часть:**

Программа запускается как Next.js приложение:

```bash
npm run dev
```

или

```bash
npm run build
npm start
```

### 3.2. Способы передачи параметров данных

**REST API:**

Все параметры передаются через HTTP-запросы:

- **GET запросы:** Параметры в URL или query string
- **POST/PUT запросы:** Данные в теле запроса в формате JSON
- **Заголовки:** Content-Type: application/json, Accept: application/json

**Пример GET запроса:**
```bash
GET /api/companies/{id}
```

**Пример POST запроса:**
```bash
POST /api/companies
Content-Type: application/json

{
  "fullName": "Предприятие",
  "shortName": "Предпр"
}
```

### 3.3. Описание процедур вызова

**3.3.1. Вызов через REST API:**

1. Формирование HTTP-запроса с необходимыми параметрами
2. Отправка запроса на соответствующий endpoint
3. Получение ответа в формате JSON
4. Обработка ответа и извлечение данных

**3.3.2. Вызов через веб-интерфейс:**

1. Открытие веб-браузера
2. Переход по URL приложения
3. Взаимодействие с интерфейсом через формы и кнопки
4. Автоматическая отправка запросов к API

**3.3.3. Вызов через Swagger UI:**

1. Открытие `http://localhost:8080/swagger-ui.html`
2. Выбор нужного endpoint
3. Заполнение параметров запроса
4. Выполнение запроса через интерфейс Swagger

## 4. ВХОДНЫЕ И ВЫХОДНЫЕ ДАННЫЕ

### 4.1. Организация входной информации

**4.1.1. Формат данных:**

- Формат: JSON (UTF-8)
- Протокол: HTTP/HTTPS REST API
- Типы данных: строки, числа, булевы значения, объекты, массивы

**4.1.2. Структура входных данных:**

**Создание предприятия:**
```json
{
  "fullName": "Общество с ограниченной ответственностью \"АПК\"",
  "shortName": "ООО \"АПК\""
}
```

**Регулярный пакет телеметрии:**
```json
{
  "workShiftId": "123e4567-e89b-12d3-a456-426614174000",
  "weight": 1250.5,
  "fillLevel": 75.3,
  "coordinate": {
    "latitude": 47.2357,
    "longitude": 39.7015
  },
  "direction": 45.0,
  "timestamp": "2024-01-15T10:30:00"
}
```

**Данные вибрации:**
```json
{
  "workShiftId": "123e4567-e89b-12d3-a456-426614174000",
  "sensorLocation": "Выгрузной шнек",
  "vibrationValues": "12.5, 13.1, 12.8, 14.2, 13.5",
  "timestamp": "2024-01-15T10:30:00"
}
```

**4.1.3. Кодирование входных данных:**

- Кодировка: UTF-8
- Формат дат: ISO 8601 (YYYY-MM-DDTHH:mm:ss)
- Координаты: десятичные градусы (широта, долгота)
- UUID: стандартный формат (xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)

### 4.2. Организация выходной информации

**4.2.1. Формат данных:**

- Формат: JSON (UTF-8)
- Протокол: HTTP/HTTPS REST API
- Коды статуса: 200 OK, 400 Bad Request, 404 Not Found, 500 Internal Server Error

**4.2.2. Структура выходных данных:**

**Ответ с данными предприятия:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "fullName": "Общество с ограниченной ответственностью \"АПК\"",
  "shortName": "ООО \"АПК\""
}
```

**Ответ с оценкой потерь зерна:**
```json
{
  "id": 1,
  "workShift": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "employee": {
      "id": "emp-001",
      "firstName": "Иван",
      "lastName": "Иванов"
    }
  },
  "lossWeight": 150.5,
  "lossPercentage": 2.1,
  "calculatedAt": "2024-01-15T18:00:00",
  "calculationMethod": "Анализ уровня заполненности"
}
```

**4.2.3. Кодирование выходных данных:**

- Кодировка: UTF-8
- Формат дат: ISO 8601
- Числовые значения: десятичные числа с плавающей точкой
- Булевы значения: true/false

### 4.3. Обработка ошибок

**Формат ответа об ошибке:**
```json
{
  "error": "Описание ошибки",
  "status": 400,
  "timestamp": "2024-01-15T10:30:00"
}
```

**Типы ошибок:**
- 400 Bad Request - некорректные входные данные
- 404 Not Found - ресурс не найден
- 500 Internal Server Error - внутренняя ошибка сервера

## 5. СООБЩЕНИЯ

### 5.1. Сообщения программисту

**5.1.1. Сообщения об ошибках валидации:**

```
ERROR: Validation failed for field 'fullName': must not be blank
```
**Действия:** Проверьте входные данные, убедитесь, что все обязательные поля заполнены.

**5.1.2. Сообщения об ошибках базы данных:**

```
ERROR: Unable to save entity: database connection lost
```
**Действия:** Проверьте подключение к базе данных, убедитесь, что PostgreSQL запущен.

**5.1.3. Сообщения об ошибках обработки:**

```
ERROR: Failed to process telemetry packet: invalid format
```
**Действия:** Проверьте формат входных данных, убедитесь, что данные соответствуют ожидаемой структуре.

### 5.2. Сообщения оператору

**5.2.1. Сообщения об успешных операциях:**

```
INFO: Company created successfully with ID: 123e4567-e89b-12d3-a456-426614174000
```
**Действия:** Операция выполнена успешно, можно продолжать работу.

**5.2.2. Предупреждения:**

```
WARN: High vibration detected on vehicle veh-001
```
**Действия:** Проверьте состояние техники, возможно требуется техническое обслуживание.

**5.2.3. Критические сообщения:**

```
ERROR: Fuel theft detected: suspicious drop of 25.5 liters
```
**Действия:** Немедленно проверьте технику и примите меры безопасности.

### 5.3. Действия при получении сообщений

**При ошибках валидации:**
1. Проверьте входные данные
2. Убедитесь, что все обязательные поля заполнены
3. Проверьте форматы данных (даты, UUID, координаты)
4. Повторите запрос с корректными данными

**При ошибках базы данных:**
1. Проверьте подключение к базе данных
2. Убедитесь, что PostgreSQL запущен
3. Проверьте логи базы данных
4. При необходимости перезапустите приложение

**При критических ошибках:**
1. Сохраните логи ошибок
2. Проверьте состояние системы
3. При необходимости восстановите из резервной копии
4. Обратитесь в техническую поддержку

## ПРИЛОЖЕНИЯ

**Приложение А. Примеры использования API**

Содержит подробные примеры использования всех endpoints API с примерами запросов и ответов.

**Приложение Б. Схемы данных**

Содержит схемы всех используемых структур данных (Entity, DTO) с описанием полей и типов.

**Приложение В. Коды ошибок**

Содержит полный список кодов ошибок с описаниями и рекомендациями по устранению.

